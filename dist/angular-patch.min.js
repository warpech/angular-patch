/**
 * angular-patch 0.1.3-dev
 * 
 * Date: Fri Nov 16 2012 14:29:37 GMT+0100 (Central European Standard Time)
*/
function ngAppFactory(){return["$http","appContext","$rootScope","StarcounterLib.config",function(e,t,n,r){var i={getRequestUrl:function(e){return"/__vm/"+e["View-Model"]}},s={};angular.extend(s,i,r);var o={restrict:"A",compile:function(i,o,u){function l(e){a=angular.copy(e);for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);v(n)}function c(e,t){t.length&&(jsonpatch.apply(a,angular.copy(t)),jsonpatch.apply(e,t))}function h(e){var t=document.getElementsByTagName("meta");for(var n=0,r=t.length;n<r;n++)if(angular.element(t[n]).attr("name")=="View-Model"){e["View-Model"]=angular.element(t[n]).attr("content");break}}function p(t){e({method:"GET",url:s.getRequestUrl(t)}).success(function(e,t,n,r){l(e),f=!0})}function d(t,n){e({method:"PATCH",url:s.getRequestUrl(t),data:n}).success(function(e,n,r,i){c(t,e),t.$$phase||t.$digest()})}function v(e){var n=t.getScopeTree(e),r=[];for(var i in n.locals){if(i=="View-Model")continue;n.locals.hasOwnProperty(i)&&r.push(i)}g(e,r)}function m(e,t,n){var t=t||"",n=n||[];if(typeof t!=""&&typeof e=="object")if(angular.isArray(e))if(e.length<3)n.push({replace:t,value:e[e.length-1]});else{if(e[2]!=0)throw e[2]==2?new Error("text diff not implemented"):new Error("invalid diff type");n.push({remove:t})}else{var r;if(e._t=="a")for(r in e)r!=="_t"&&e.hasOwnProperty(r)&&m(e[r],t+"/"+r,n);else for(r in e)e.hasOwnProperty(r)&&m(e[r],t+"/"+r,n)}return n}function g(e,t){for(var n=0,r=t.length;n<r;n++)e.$watch(t[n],function(e){return function(t,n,r){if(f){if(t===n)return;var i="/"+e.replace(/\./g,"/"),s=m(jsondiffpatch.diff(a[e],t),i);for(var o=0,u=s.length;o<u;o++)if(typeof s[o].replace!="undefined"&&s[o].value==="$$null"){s[o].value=null;var l=jsonpatch.apply(a,[{test:s[o].replace,value:!1}]);jsonpatch.apply(r,[{replace:s[o].replace,value:l?!1:null}])}s.length&&d(r,s)}}}(t[n]),!0)}var a={},f=!1;return window.updateServer=d,function(n,r,i,s){if(i.serverScope){e.get(i.serverScope).success(function(e,t,n,r){console.log("NOTICE: Local scope was loaded ("+i.serverScope+")"),l(e),f=!0}).error(function(e,t,n,r){console.log("ERROR: Loading "+i.serverScope+" ("+t+")")});return}typeof window.__elim_rq!="undefined"?(l(window.__elim_rq),f=!0):(h(n),p(n))}}};return o}]}angular.module("StarcounterLib.config",[]).value("StarcounterLib.config",{}),angular.module("StarcounterLib",["panelApp","StarcounterLib.config"]).directive("ngApp",ngAppFactory()).directive("ngRemoteapp",ngAppFactory()),angular.element(document).ready(function(){function e(e){function o(e){e&&t.push(e)}var t=[e],n,r,i=["ng:remoteapp","ng-remoteapp","x-ng-remoteapp","data-ng-remoteapp"],s=/\sng[:\-]remoteapp(:\s*([\w\d_]+);?)?\s/;angular.forEach(i,function(t){i[t]=!0,o(document.getElementById(t)),t=t.replace(":","\\:"),e.querySelectorAll&&(angular.forEach(e.querySelectorAll("."+t),o),angular.forEach(e.querySelectorAll("."+t+"\\:"),o),angular.forEach(e.querySelectorAll("["+t+"]"),o))}),angular.forEach(t,function(e){if(!n){var t=" "+e.className+" ",o=s.exec(t);o?(n=e,r=(o[2]||"").replace(/\s+/g,",")):angular.forEach(e.attributes,function(t){!n&&i[t.name]&&(n=e,r=t.value)})}});if(n){var u=r?r.split(" "):[];u.unshift("StarcounterLib"),angular.bootstrap(n,u)}}e(document)}),angular.module("panelApp",[]).factory("appContext",function(){var e=function(t){var n=[],r=[];return function i(e,t){var s,o,u;switch(typeof e){case"object":if(!e)return null;for(s=0;s<n.length;s+=1)if(n[s]===e)return{$ref:r[s]};n.push(e),r.push(t);if(Object.prototype.toString.apply(e)==="[object Array]"){u=[];for(s=0;s<e.length;s+=1)u[s]=i(e[s],t+"["+s+"]")}else{u={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(u[o]=i(e[o],t+"["+JSON.stringify(o)+"]"))}return u;case"number":case"string":case"boolean":return e}}(t,"$")};return{getScopeTree:function(t){var n={},r=function(t,n){n.locals={};var i={};for(prop in t)t.hasOwnProperty(prop)&&prop!=="this"&&prop[0]!=="$"&&(i[prop]=t[prop]);n.locals=e(i),n.id=t.$id,window.__ngDebug&&(n.watchers=__ngDebug.watchers[t.$id]),n.children=[];var s;if(t.$$childHead){s=t.$$childHead;do r(s,n.children[n.children.length]={});while(s=s.$$nextSibling)}};return r(t,n),n}}}),function(){var e={};typeof jsondiffpatch!="undefined"&&(e=jsondiffpatch),e.config={textDiffMinLength:60},e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var t=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},n=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},r=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},i=function(e,t){var n,r,i,s=t.length,o=e.length,a;a=function(r){i=u(e[r],t[r]),typeof i!="undefined"&&(typeof n=="undefined"&&(n={_t:"a"}),n[r]=i)};for(r=0;r<Math.max(s,o);r++)a(r);return n},s=function(e,t,n){var r,i=e.length,s=t.length,o,a=0;typeof n=="function"?o=n:o=function(e){return e[n]};for(var f=0;f<s;f++)typeof r=="undefined"&&(r={_t:"a"}),r[o(t[f])]=[t[f]],a++;for(var f=0;f<i;f++){var l=o(e[f]);if(typeof r=="undefined"||typeof r[l]=="undefined")typeof r=="undefined"&&(r={_t:"a"}),r[l]=[e[f],0,0],a++;else{var c=u(e[f],r[l][0]);typeof c=="undefined"?(delete r[l],a--):r[l]=c}}if(a>0)return r;return},o=function(e,t){var r,i,s,o;o=function(o){n(t[s])&&(t[s+"_key"]||t["_"+s+"_key"])&&(t[s]._key=t[s+"_key"]||t["_"+s+"_key"]),n(e[s])&&(e[s+"_key"]||e["_"+s+"_key"])&&(e[s]._key=e[s+"_key"]||e["_"+s+"_key"]),i=u(e[s],t[s]),typeof i!="undefined"&&(typeof r=="undefined"&&(r={}),r[s]=i)};for(s in t)t.hasOwnProperty(s)&&o(s);for(s in e)e.hasOwnProperty(s)&&typeof t[s]=="undefined"&&o(s);return r},u=e.diff=function(u,a){var f,l,c,h,p;if(u===a)return;f=typeof a,l=typeof u,c=a===null,h=u===null,l=="object"&&r(u)&&(l="date");if(f=="object"&&r(a)){f="date";if(l=="date"&&u.getTime()===a.getTime())return}if(c||h||f=="undefined"||f!=l||f=="number"||l=="number"||f=="boolean"||l=="boolean"||f=="string"||l=="string"||f=="date"||l=="date"||f==="object"&&n(a)!=n(u)){p=[];if(typeof u!="undefined")if(typeof a!="undefined"){var d=f=="string"&&l=="string"&&Math.min(u.length,a.length)>e.config.textDiffMinLength;d&&!e.config.textDiff&&t(),d&&e.config.textDiff?p.push(e.config.textDiff(u,a),0,2):(p.push(u),p.push(a))}else p.push(u),p.push(0,0);else p.push(a);return p}return n(a)?a._key||u._key?s(u,a,a._key||u._key):i(u,a):o(u,a)},a=function(e,t){if(n(e)&&e._key){var r=e._key;typeof e._key!="function"&&(r=function(t){return t[e._key]});for(var i=0;i<e.length;i++)if(r(e[i])===t)return e[i];return}return e[t]};e.getByKey=a;var f=function(e,t,r){if(n(e)&&e._key){var i=e._key;typeof e._key!="function"&&(i=function(t){return t[e._key]});for(var s=0;s<e.length;s++)if(i(e[s])===t){typeof r=="undefined"?(e.splice(s,1),s--):e[s]=r;return}typeof r!="undefined"&&e.push(r);return}typeof r=="undefined"?n(e)?e.splice(t,1):delete e[t]:e[t]=r},l=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},c=e.reverse=function(e){var t,i;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!r(e)){if(n(e)){if(e.length<3)return e.length==1?[e[0],0,0]:[e[1],e[0]];if(e[2]==0)return[e[0]];if(e[2]==2)return[l(e[0]),0,2];throw new Error("invalid diff type")}i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=c(e[t]));return i}return typeof e=="string"&&e.slice(0,2)==="@@"?l(e):e},h=e.patch=function(r,i,s,o){var u,l,c="",p;typeof i!="string"?(o=s,s=i,i=null):typeof r!="object"&&(i=null),o&&(c+=o),c+="/",i!==null&&(c+=i);if(typeof s=="object")if(n(s)){if(s.length<3)return l=s[s.length-1],i!==null&&f(r,i,l),l;if(s[2]!=0){if(s[2]==2){e.config.textPatch||t();if(!e.config.textPatch)throw new Error("textPatch function not found");try{l=e.config.textPatch(a(r,i),s[0])}catch(d){throw new Error('cannot apply patch at "'+c+'": '+d)}return i!==null&&f(r,i,l),l}throw new Error("invalid diff type")}if(i===null)return;f(r,i)}else if(s._t=="a"){p=i===null?r:a(r,i);if(typeof p!="object"||!n(p))throw new Error('cannot apply patch at "'+c+'": array expected');for(u in s)u!=="_t"&&s.hasOwnProperty(u)&&h(p,u,s[u],c)}else{p=i===null?r:a(r,i);if(typeof p!="object"||n(p))throw new Error('cannot apply patch at "'+c+'": object expected');for(u in s)s.hasOwnProperty(u)&&h(p,u,s[u],c)}return r},p=e.unpatch=function(e,t,n,r){return typeof t!="string"?h(e,c(t),n):h(e,t,c(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):window.jsondiffpatch=e}(),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(function(e,t){return typeof exports!="undefined"?t(e,exports):typeof define=="function"&&define.amd?define(["exports"],function(n){return e.jsonpatch=t(e,n)}):e.jsonpatch=t(e,{})})(this,function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;return x=Object.prototype.toString,c=Object.prototype.hasOwnProperty,h=function(e){return x.call(e)==="[object Array]"},d=function(e){return x.call(e)==="[object Object]"},v=function(e){return x.call(e)==="[object String]"},T=function(t,n,r){var i,s,o,u,a;if(t===n)return t!==0||1/t===1/n;if(t===null||n===null)return t===n;i=x.call(t);if(i!==x.call(n))return!1;switch(i){case"[object String]":String(t)===String(n);break;case"[object Number]":t=+t,n=+n,t!==t?n!==n:t===0?1/t===1/n:t===n;break;case"[object Boolean]":+t===+n}if(typeof t!="object"||typeof n!="object")return!1;o=r.length;while(o--)if(r[o]===t)return!0;r.push(t),a=0,u=!0;if(i==="[object Array]"){a=t.length,u=a===n.length;if(u)while(a--)if(!(u=e.call(t,a)>=0==e.call(n,a)>=0&&T(t[a],n[a],r)))break}else{if(e.call(t,"constructor")>=0!=e.call(n,"constructor")>=0||t.constructor!==n.constructor)return!1;for(s in t)if(c.call(t,s)){a++;if(!(u=c.call(n,s)&&T(t[s],n[s],r)))break}if(u){for(s in n)if(c.call(n,s)&&!(a--))break;u=!a}}return r.pop(),u},p=function(e,t){return T(e,t,[])},s=function(e){function t(e){this.name="JSONPatchError",this.message=e||"JSON patch error"}return n(t,e),t}(Error),r=function(e){function t(e){this.name="InvalidPatch",this.message=e||"Invalid patch"}return n(t,e),t}(s),u=function(e){function t(e){this.name="PatchConflictError",this.message=e||"Patch conflict"}return n(t,e),t}(s),o=function(){function e(e,t){var n,i,s,o,u;t==null&&(t=!0);if(e&&(s=e.split("/")).shift()!=="")throw new r;for(n=o=0,u=s.length;o<u;n=++o)i=s[n],s[n]=decodeURIComponent(i);this.accessor=s.pop(),this.path=s}return e.prototype.getObject=function(e){var t,n,r,i;i=this.path;for(n=0,r=i.length;n<r;n++){t=i[n],h(e)&&(t=parseInt(t,10));if(!(t in e))throw new u("Array location out of bounds or not an instance property");e=e[t]}return e},e}(),i=function(){function e(e){var t,n,i,s,u;for(t in e){if(!(i=g[t]))continue;if(this.operation)throw new r;if((n=b[t])&&e[n]===void 0)throw new r("Patch member "+n+" not defined");this.operation=g[t],this.pointer=new o(e[t]),u=e[n];if(s=m[t])u=s(u);this.supplement=u}if(!this.operation)throw new r}return e.prototype.apply=function(e){return this.operation(e,this.pointer,this.supplement)},e}(),a=function(e,t,n){var r,i;i=t.getObject(e),r=t.accessor;if(h(i)){r=parseInt(r,10);if(r<0||r>i.length)throw new u("Index "+r+" out of bounds");i.splice(r,0,n)}else{if(r in i)throw new u("Value at "+r+" exists");i[r]=n}},w=function(e,t){var n,r;r=t.getObject(e),n=t.accessor;if(h(r)){n=parseInt(n,10);if(!(n in r))throw new u("Value at "+n+" does not exist");r.splice(n,1)}else{if(!(n in r))throw new u("Value at "+n+" does not exist");delete r[n]}},E=function(e,t,n){var r,i;i=t.getObject(e),r=t.accessor;if(h(i)){r=parseInt(r,10);if(!(r in i))throw new u("Value at "+r+" does not exist");i.splice(r,1,n)}else{if(!(r in i))throw new u("Value at "+r+" does not exist");i[r]=n}},S=function(e,t,n){var r,i;return i=t.getObject(e),r=t.accessor,h(i)&&(r=parseInt(r,10)),p(i[r],n)},y=function(e,t,n){var r,i,s;i=t.getObject(e),r=t.accessor;if(h(i)){r=parseInt(r,10);if(!(r in i))throw new u("Value at "+r+" does not exist");s=i.splice(r,1)[0]}else{if(!(r in i))throw new u("Value at "+r+" does not exist");s=i[r],delete i[r]}i=n.getObject(e),r=n.accessor;if(h(i)){r=parseInt(r,10);if(r<0||r>i.length)throw new u("Index "+r+" out of bounds");i.splice(r,0,s)}else{if(r in i)throw new u("Value at "+r+" exists");i[r]=s}},g={add:a,remove:w,replace:E,move:y,test:S},b={add:"value",remove:null,replace:"value",test:"value",move:"to"},m={move:function(e){return new o(e)}},f=function(e,t){return l(t)(e)},l=function(e){var t,n,r,s;t=[];for(r=0,s=e.length;r<s;r++)n=e[r],t.push(new i(n));return function(e){var n,r,i,s;for(i=0,s=t.length;i<s;i++)n=t[i],r=n.apply(e);return r}},t.apply=f,t.compile=l,t.JSONPatchError=s,t.InvalidPatchError=r,t.PatchConflictError=u,t})}.call(this);