/**
 * angular-patch 0.1.6
 * 
 * Date: Fri Mar 01 2013 16:51:52 GMT+0100 (Central European Standard Time)
*/

function ngAppFactory(){return["$http","appContext","$rootScope","StarcounterLib.config",function(t,e,n,r){var o={getRequestUrl:function(t){return"/__vm/"+t["View-Model"]}},i={};angular.extend(i,o,r);var a={restrict:"A",compile:function(){function r(t){s=angular.copy(t);for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);u(n)}function o(t,e){e.length&&(jsonpatch.apply(s,angular.copy(e)),jsonpatch.apply(t,e),console.log("AFTER PATCHed",t.Items[0].Product._Options[0]))}function a(t){for(var e=document.getElementsByTagName("meta"),n=0,r=e.length;r>n;n++)if("View-Model"==angular.element(e[n]).attr("name")){t["View-Model"]=angular.element(e[n]).attr("content");break}}function c(e){t({method:"GET",url:i.getRequestUrl(e)}).success(function(t){r(t),h=!0})}function f(e,n){t({method:"PATCH",url:i.getRequestUrl(e),data:n}).success(function(t){o(e,t),e.$$phase?setTimeout(function(){e.$apply()}):e.$apply()})}function u(t){var n=e.getScopeTree(t),r=[];for(var o in n.locals)"View-Model"!=o&&n.locals.hasOwnProperty(o)&&r.push(o);p(t,r)}function l(t,e,n){var e=e||"",n=n||[];if(""!=typeof e&&"object"==typeof t)if(angular.isArray(t))if(3>t.length)n.push({replace:e,value:t[t.length-1]});else{if(0!=t[2])throw 2==t[2]?Error("text diff not implemented"):Error("invalid diff type");n.push({remove:e})}else{var r;if("a"==t._t)for(r in t)"_t"!==r&&t.hasOwnProperty(r)&&l(t[r],e+"/"+r,n);else for(r in t)t.hasOwnProperty(r)&&l(t[r],e+"/"+r,n)}return n}function p(t,e){for(var n=0,r=e.length;r>n;n++)t.$watch(e[n],function(t){return function(e,n,r){if(h){if(e===n)return;for(var o="/"+t.replace(/\./g,"/"),i=l(jsondiffpatch.diff(s[t],e),o),a=0,c=i.length;c>a;a++)if(i[a].replace!==void 0&&"$$null"===i[a].value){i[a].value=null;var u=jsonpatch.apply(s,[{test:i[a].replace,value:!1}]);jsonpatch.apply(r,[{replace:i[a].replace,value:u?!1:null}])}i.length&&f(r,i)}}}(e[n]),!0)}var s={},h=!1;return window.updateServer=f,function(e,n,o){return o.mockupData&&window.__elim_req===void 0?(t.get(o.mockupData).success(function(t){console.log("NOTICE: Local scope was loaded ("+o.mockupData+")"),r(t),h=!0}).error(function(t,e){console.log("ERROR: Loading "+o.mockupData+" ("+e+")")}),void 0):(window.__elim_req!==void 0?(r(window.__elim_req),h=!0):(a(e),c(e)),void 0)}}};return a}]}angular.module("StarcounterLib.config",[]).value("StarcounterLib.config",{}),angular.module("StarcounterLib",["panelApp","StarcounterLib.config"]).directive("ngApp",ngAppFactory()).directive("ngRemoteapp",ngAppFactory()).directive("uiClick",["$parse",function(t){var e={restrict:"A",compile:function(e,n){var r=t(n.uiClick+' = "$$null"');return function(t,e){e.bind("click",function(e){t.$apply(function(){r(t,{$event:e})})})}}};return e}]),angular.element(document).ready(function(){function t(t){function e(t){t&&o.push(t)}var n,r,o=[t],i=["ng:remoteapp","ng-remoteapp","x-ng-remoteapp","data-ng-remoteapp"],a=/\sng[:\-]remoteapp(:\s*([\w\d_]+);?)?\s/;if(angular.forEach(i,function(n){i[n]=!0,e(document.getElementById(n)),n=n.replace(":","\\:"),t.querySelectorAll&&(angular.forEach(t.querySelectorAll("."+n),e),angular.forEach(t.querySelectorAll("."+n+"\\:"),e),angular.forEach(t.querySelectorAll("["+n+"]"),e))}),angular.forEach(o,function(t){if(!n){var e=" "+t.className+" ",o=a.exec(e);o?(n=t,r=(o[2]||"").replace(/\s+/g,",")):angular.forEach(t.attributes,function(e){!n&&i[e.name]&&(n=t,r=e.value)})}}),n){var c=r?r.split(" "):[];c.unshift("StarcounterLib"),angular.bootstrap(n,c)}}t(document)}),angular.module("panelApp",[]).factory("appContext",function(){var t=function t(t){var e=[],n=[];return function r(t,o){var i,a,c;switch(typeof t){case"object":if(!t)return null;for(i=0;e.length>i;i+=1)if(e[i]===t)return{$ref:n[i]};if(e.push(t),n.push(o),"[object Array]"===Object.prototype.toString.apply(t))for(c=[],i=0;t.length>i;i+=1)c[i]=r(t[i],o+"["+i+"]");else{c={};for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&(c[a]=r(t[a],o+"["+JSON.stringify(a)+"]"))}return c;case"number":case"string":case"boolean":return t}}(t,"$")};return{getScopeTree:function(e){var n={},r=function(e,n){n.locals={};var o={};for(prop in e)e.hasOwnProperty(prop)&&"this"!==prop&&"$"!==prop[0]&&(o[prop]=e[prop]);n.locals=t(o),n.id=e.$id,window.__ngDebug&&(n.watchers=__ngDebug.watchers[e.$id]),n.children=[];var i;if(e.$$childHead){i=e.$$childHead;do r(i,n.children[n.children.length]={});while(i=i.$$nextSibling)}};return r(e,n),n}}}),function(){var t={};"undefined"!=typeof jsondiffpatch&&(t=jsondiffpatch),t.config={textDiffMinLength:60},t.dateReviver=function(t,e){var n;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6])):e};var e=function(){var e;return t.config.diff_match_patch&&(e=new t.config.diff_match_patch.diff_match_patch),"undefined"!=typeof diff_match_patch&&("function"==typeof diff_match_patch?e=new diff_match_patch:"object"==typeof diff_match_patch&&"function"==typeof diff_match_patch.diff_match_patch&&(e=new diff_match_patch.diff_match_patch)),e?(t.config.textDiff=function(t,n){return e.patch_toText(e.patch_make(t,n))},t.config.textPatch=function(t,n){for(var r=e.patch_apply(e.patch_fromText(n),t),o=0;r[1].length>o;o++)if(!r[1][o])throw Error("text patch failed");return r[0]},!0):void 0},n="function"==typeof Array.isArray?Array.isArray:function(t){return"object"==typeof t&&t instanceof Array},r=function(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)},o=function(t,e){var n,r,o,i,a=e.length,f=t.length;for(i=function(r){o=c(t[r],e[r]),o!==void 0&&(n===void 0&&(n={_t:"a"}),n[r]=o)},r=0;Math.max(a,f)>r;r++)i(r);return n},i=function(t,e,n){var r,o,i=t.length,a=e.length,f=0;o="function"==typeof n?n:function(t){return t[n]};for(var u=0;a>u;u++)r===void 0&&(r={_t:"a"}),r[o(e[u])]=[e[u]],f++;for(var u=0;i>u;u++){var l=o(t[u]);if(r===void 0||r[l]===void 0)r===void 0&&(r={_t:"a"}),r[l]=[t[u],0,0],f++;else{var p=c(t[u],r[l][0]);p===void 0?(delete r[l],f--):r[l]=p}}return f>0?r:void 0},a=function(t,e){var r,o,i,a;a=function(){n(e[i])&&(e[i+"_key"]||e["_"+i+"_key"])&&(e[i]._key=e[i+"_key"]||e["_"+i+"_key"]),n(t[i])&&(t[i+"_key"]||t["_"+i+"_key"])&&(t[i]._key=t[i+"_key"]||t["_"+i+"_key"]),o=c(t[i],e[i]),o!==void 0&&(r===void 0&&(r={}),r[i]=o)};for(i in e)e.hasOwnProperty(i)&&a(i);for(i in t)t.hasOwnProperty(i)&&e[i]===void 0&&a(i);return r},c=t.diff=function(c,f){var u,l,p,s,h;if(c!==f&&(u=typeof f,l=typeof c,p=null===f,s=null===c,"object"==l&&r(c)&&(l="date"),"object"!=u||!r(f)||(u="date","date"!=l||c.getTime()!==f.getTime()))){if(p||s||"undefined"==u||u!=l||"number"==u||"number"==l||"boolean"==u||"boolean"==l||"string"==u||"string"==l||"date"==u||"date"==l||"object"===u&&n(f)!=n(c)){if(h=[],c!==void 0)if(f!==void 0){var d="string"==u&&"string"==l&&Math.min(c.length,f.length)>t.config.textDiffMinLength;d&&!t.config.textDiff&&e(),d&&t.config.textDiff?h.push(t.config.textDiff(c,f),0,2):(h.push(c),h.push(f))}else h.push(c),h.push(0,0);else h.push(f);return h}return n(f)?f._key||c._key?i(c,f,f._key||c._key):o(c,f):a(c,f)}},f=function(t,e){if(!n(t)||!t._key)return t[e];var r=t._key;"function"!=typeof t._key&&(r=function(e){return e[t._key]});for(var o=0;t.length>o;o++)if(r(t[o])===e)return t[o]};t.getByKey=f;var u=function(t,e,r){if(n(t)&&t._key){var o=t._key;"function"!=typeof t._key&&(o=function(e){return e[t._key]});for(var i=0;t.length>i;i++)if(o(t[i])===e)return r===void 0?(t.splice(i,1),i--):t[i]=r,void 0;return r!==void 0&&t.push(r),void 0}r===void 0?n(t)?t.splice(e,1):delete t[e]:t[e]=r},l=function(e){return t.config.textDiffReverse||(t.config.textDiffReverse=function(t){var e,n,r,o,i,a,c,f=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=t.split("\n"),e=0,n=r.length;n>e;e++){o=r[e];var l=o.slice(0,1);"@"===l?(f=u.exec(o),i=e,a=null,c=null,r[i]="@@ -"+f[3]+","+f[4]+" +"+f[1]+","+f[2]+" @@"):"+"==l?(a=e,r[e]="-"+r[e].slice(1)):"-"==l&&(c=e,r[e]="+"+r[e].slice(1))}return r.join("\n")}),t.config.textDiffReverse(e)},p=t.reverse=function(t){var e,o;if(void 0!==t){if(null===t)return null;if("object"==typeof t&&!r(t)){if(n(t)){if(3>t.length)return 1==t.length?[t[0],0,0]:[t[1],t[0]];if(0==t[2])return[t[0]];if(2==t[2])return[l(t[0]),0,2];throw Error("invalid diff type")}o={};for(e in t)t.hasOwnProperty(e)&&(o[e]=p(t[e]));return o}return"string"==typeof t&&"@@"===t.slice(0,2)?l(t):t}},s=t.patch=function(r,o,i,a){var c,l,p,h="";if("string"!=typeof o?(a=i,i=o,o=null):"object"!=typeof r&&(o=null),a&&(h+=a),h+="/",null!==o&&(h+=o),"object"==typeof i)if(n(i)){if(3>i.length)return l=i[i.length-1],null!==o&&u(r,o,l),l;if(0!=i[2]){if(2==i[2]){if(t.config.textPatch||e(),!t.config.textPatch)throw Error("textPatch function not found");try{l=t.config.textPatch(f(r,o),i[0])}catch(d){throw Error('cannot apply patch at "'+h+'": '+d)}return null!==o&&u(r,o,l),l}throw Error("invalid diff type")}if(null===o)return;u(r,o)}else if("a"==i._t){if(p=null===o?r:f(r,o),"object"!=typeof p||!n(p))throw Error('cannot apply patch at "'+h+'": array expected');for(c in i)"_t"!==c&&i.hasOwnProperty(c)&&s(p,c,i[c],h)}else{if(p=null===o?r:f(r,o),"object"!=typeof p||n(p))throw Error('cannot apply patch at "'+h+'": object expected');for(c in i)i.hasOwnProperty(c)&&s(p,c,i[c],h)}return r};t.unpatch=function(t,e,n,r){return"string"!=typeof e?s(t,p(e),n):s(t,e,p(n),r)},"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=t:"function"==typeof define&&define.amd?define(t):window.jsondiffpatch=t}(),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};(function(t,e){return"undefined"!=typeof exports?e(t,exports):"function"==typeof define&&define.amd?define(["exports"],function(n){return t.jsonpatch=e(t,n)}):t.jsonpatch=e(t,{})})(this,function(e){var r,o,i,a,c,f,u,l,p,s,h,d,g,y,v,w,m,_,b,j,x,k;return x=Object.prototype.toString,p=Object.prototype.hasOwnProperty,s=function(t){return"[object Array]"===x.call(t)},d=function(t){return"[object Object]"===x.call(t)},g=function(t){return"[object String]"===x.call(t)},k=function(e,n,r){var o,i,a,c,f;if(e===n)return 0!==e||1/e===1/n;if(null===e||null===n)return e===n;if(o=x.call(e),o!==x.call(n))return!1;switch(o){case"[object String]":break;case"[object Number]":e=+e,n=+n;break;case"[object Boolean]":}if("object"!=typeof e||"object"!=typeof n)return!1;for(a=r.length;a--;)if(r[a]===e)return!0;if(r.push(e),f=0,c=!0,"[object Array]"===o){if(f=e.length,c=f===n.length)for(;f--&&(c=t.call(e,f)>=0==t.call(n,f)>=0&&k(e[f],n[f],r)););}else{if(t.call(e,"constructor")>=0!=t.call(n,"constructor")>=0||e.constructor!==n.constructor)return!1;for(i in e)if(p.call(e,i)&&(f++,!(c=p.call(n,i)&&k(e[i],n[i],r))))break;if(c){for(i in n)if(p.call(n,i)&&!f--)break;c=!f}}return r.pop(),c},h=function(t,e){return k(t,e,[])},i=function(t){function e(t){this.name="JSONPatchError",this.message=t||"JSON patch error"}return n(e,t),e}(Error),r=function(t){function e(t){this.name="InvalidPatch",this.message=t||"Invalid patch"}return n(e,t),e}(i),c=function(t){function e(t){this.name="PatchConflictError",this.message=t||"Patch conflict"}return n(e,t),e}(i),a=function(){function t(t,e){var n,o,i,a,c;if(null==e&&(e=!0),t&&""!==(i=t.split("/")).shift())throw new r;for(n=a=0,c=i.length;c>a;n=++a)o=i[n],i[n]=decodeURIComponent(o);this.accessor=i.pop(),this.path=i}return t.prototype.getObject=function(t){var e,n,r,o;for(o=this.path,n=0,r=o.length;r>n;n++){if(e=o[n],s(t)&&(e=parseInt(e,10)),!(e in t))throw new c("Array location out of bounds or not an instance property");t=t[e]}return t},t}(),o=function(){function t(t){var e,n,o,i,c;for(e in t)if(o=v[e]){if(this.operation)throw new r;if((n=m[e])&&void 0===t[n])throw new r("Patch member "+n+" not defined");this.operation=v[e],this.pointer=new a(t[e]),c=t[n],(i=y[e])&&(c=i(c)),this.supplement=c}if(!this.operation)throw new r}return t.prototype.apply=function(t){return this.operation(t,this.pointer,this.supplement)},t}(),f=function(t,e,n){var r,o;if(o=e.getObject(t),r=e.accessor,s(o)){if(r=parseInt(r,10),0>r||r>o.length)throw new c("Index "+r+" out of bounds");o.splice(r,0,n)}else{if(r in o)throw new c("Value at "+r+" exists");o[r]=n}},_=function(t,e){var n,r;if(r=e.getObject(t),n=e.accessor,s(r)){if(n=parseInt(n,10),!(n in r))throw new c("Value at "+n+" does not exist");r.splice(n,1)}else{if(!(n in r))throw new c("Value at "+n+" does not exist");delete r[n]}},b=function(t,e,n){var r,o;if(o=e.getObject(t),r=e.accessor,s(o)){if(r=parseInt(r,10),!(r in o))throw new c("Value at "+r+" does not exist");o.splice(r,1,n)}else{if(!(r in o))throw new c("Value at "+r+" does not exist");o[r]=n}},j=function(t,e,n){var r,o;return o=e.getObject(t),r=e.accessor,s(o)&&(r=parseInt(r,10)),h(o[r],n)},w=function(t,e,n){var r,o,i;if(o=e.getObject(t),r=e.accessor,s(o)){if(r=parseInt(r,10),!(r in o))throw new c("Value at "+r+" does not exist");i=o.splice(r,1)[0]}else{if(!(r in o))throw new c("Value at "+r+" does not exist");i=o[r],delete o[r]}if(o=n.getObject(t),r=n.accessor,s(o)){if(r=parseInt(r,10),0>r||r>o.length)throw new c("Index "+r+" out of bounds");o.splice(r,0,i)}else{if(r in o)throw new c("Value at "+r+" exists");o[r]=i}},v={add:f,remove:_,replace:b,move:w,test:j},m={add:"value",remove:null,replace:"value",test:"value",move:"to"},y={move:function(t){return new a(t)}},u=function(t,e){return l(e)(t)},l=function(t){var e,n,r,i;for(e=[],r=0,i=t.length;i>r;r++)n=t[r],e.push(new o(n));return function(t){var n,r,o,i;for(o=0,i=e.length;i>o;o++)n=e[o],r=n.apply(t);return r}},e.apply=u,e.compile=l,e.JSONPatchError=i,e.InvalidPatchError=r,e.PatchConflictError=c,e})}.call(this);