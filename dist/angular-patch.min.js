/**
 * angular-patch 0.1.8
 * 
 * Date: Thu Apr 11 2013 18:28:25 GMT+0200 (Central European Daylight Time)
*/

function ngAppFactory(){return["$http","appContext","$rootScope","StarcounterLib.config",function(t,e,n,r){var o={getRequestUrl:function(t){return"/__vm/"+t["View-Model"]}},i={};angular.extend(i,o,r);var a={restrict:"A",compile:function(){function r(t){h=angular.copy(t);for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);u(n)}function o(t,e){e.length&&(jsonpatch.apply(h,angular.copy(e)),jsonpatch.apply(t,e))}function a(t){for(var e=document.getElementsByTagName("meta"),n=0,r=e.length;r>n;n++)if("View-Model"==angular.element(e[n]).attr("name")){t["View-Model"]=angular.element(e[n]).attr("content");break}}function c(e){t({method:"GET",url:i.getRequestUrl(e)}).success(function(t){r(t),s=!0})}function f(e,n){t({method:"PATCH",url:i.getRequestUrl(e),data:n}).success(function(t){o(e,t),e.$$phase?setTimeout(function(){e.$apply()}):e.$apply()})}function u(t){var n=e.getScopeTree(t),r=[];for(var o in n.locals)"View-Model"!=o&&n.locals.hasOwnProperty(o)&&r.push(o);l(t,r)}function p(t,e,n){var e=e||"",n=n||[];if(""!=typeof e&&"object"==typeof t)if(angular.isArray(t))if(3>t.length)n.push({op:"replace",path:e,value:t[t.length-1]});else{if(0!=t[2])throw 2==t[2]?Error("text diff not implemented"):Error("invalid diff type");n.push({op:"remove"})}else{var r;if("a"==t._t)for(r in t)"_t"!==r&&t.hasOwnProperty(r)&&p(t[r],e+"/"+r,n);else for(r in t)t.hasOwnProperty(r)&&p(t[r],e+"/"+r,n)}return n}function l(t,e){for(var n=0,r=e.length;r>n;n++)t.$watch(e[n],function(t){return function(e,n,r){if(s){if(e===n)return;for(var o="/"+t.replace(/\./g,"/"),i=p(jsondiffpatch.diff(h[t],e),o),a=0,c=i.length;c>a;a++)if("replace"!=typeof i[a].op&&"$$null"===i[a].value){i[a].value=null;var u=jsonpatch.apply(h,[{op:"test",path:i[a].replace,value:!1}]);jsonpatch.apply(r,[{op:"replace",path:i[a].replace,value:u?!1:null}])}i.length&&f(r,i)}}}(e[n]),!0)}var h={},s=!1;return window.updateServer=f,function(e,n,o){return o.mockupData&&window.__elim_req===void 0?(t.get(o.mockupData).success(function(t){console.log("NOTICE: Local scope was loaded ("+o.mockupData+")"),r(t),s=!0}).error(function(t,e){console.log("ERROR: Loading "+o.mockupData+" ("+e+")")}),void 0):(window.__elim_req!==void 0?(r(window.__elim_req),s=!0):(a(e),c(e)),void 0)}}};return a}]}angular.module("StarcounterLib.config",[]).value("StarcounterLib.config",{}),angular.module("StarcounterLib",["panelApp","StarcounterLib.config"]).directive("ngApp",ngAppFactory()).directive("ngRemoteapp",ngAppFactory()).directive("uiClick",["$parse",function(t){var e={restrict:"A",compile:function(e,n){return function(e,r){r.bind("click",function(r){var o=t(n.uiClick+' = "$$null"');e.$apply(function(){o(e,{$event:r})}),o=t(n.uiClick+" = null"),e.$apply(function(){o(e,{$event:r})})})}}};return e}]),angular.element(document).ready(function(){function t(t){function e(t){t&&o.push(t)}var n,r,o=[t],i=["ng:remoteapp","ng-remoteapp","x-ng-remoteapp","data-ng-remoteapp"],a=/\sng[:\-]remoteapp(:\s*([\w\d_]+);?)?\s/;if(angular.forEach(i,function(n){i[n]=!0,e(document.getElementById(n)),n=n.replace(":","\\:"),t.querySelectorAll&&(angular.forEach(t.querySelectorAll("."+n),e),angular.forEach(t.querySelectorAll("."+n+"\\:"),e),angular.forEach(t.querySelectorAll("["+n+"]"),e))}),angular.forEach(o,function(t){if(!n){var e=" "+t.className+" ",o=a.exec(e);o?(n=t,r=(o[2]||"").replace(/\s+/g,",")):angular.forEach(t.attributes,function(e){!n&&i[e.name]&&(n=t,r=e.value)})}}),n){var c=r?r.split(" "):[];c.unshift("StarcounterLib"),angular.bootstrap(n,c)}}t(document)}),angular.module("panelApp",[]).factory("appContext",function(){var t=function t(t){var e=[],n=[];return function r(t,o){var i,a,c;switch(typeof t){case"object":if(!t)return null;for(i=0;e.length>i;i+=1)if(e[i]===t)return{$ref:n[i]};if(e.push(t),n.push(o),"[object Array]"===Object.prototype.toString.apply(t))for(c=[],i=0;t.length>i;i+=1)c[i]=r(t[i],o+"["+i+"]");else{c={};for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&(c[a]=r(t[a],o+"["+JSON.stringify(a)+"]"))}return c;case"number":case"string":case"boolean":return t}}(t,"$")};return{getScopeTree:function(e){var n={},r=function(e,n){n.locals={};var o={};for(prop in e)e.hasOwnProperty(prop)&&"this"!==prop&&"$"!==prop[0]&&(o[prop]=e[prop]);n.locals=t(o),n.id=e.$id,window.__ngDebug&&(n.watchers=__ngDebug.watchers[e.$id]),n.children=[];var i;if(e.$$childHead){i=e.$$childHead;do r(i,n.children[n.children.length]={});while(i=i.$$nextSibling)}};return r(e,n),n}}}),function(){var t={};"undefined"!=typeof jsondiffpatch&&(t=jsondiffpatch),t.config={textDiffMinLength:60},t.dateReviver=function(t,e){var n;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6])):e};var e=function(){var e;return t.config.diff_match_patch&&(e=new t.config.diff_match_patch.diff_match_patch),"undefined"!=typeof diff_match_patch&&("function"==typeof diff_match_patch?e=new diff_match_patch:"object"==typeof diff_match_patch&&"function"==typeof diff_match_patch.diff_match_patch&&(e=new diff_match_patch.diff_match_patch)),e?(t.config.textDiff=function(t,n){return e.patch_toText(e.patch_make(t,n))},t.config.textPatch=function(t,n){for(var r=e.patch_apply(e.patch_fromText(n),t),o=0;r[1].length>o;o++)if(!r[1][o])throw Error("text patch failed");return r[0]},!0):void 0},n="function"==typeof Array.isArray?Array.isArray:function(t){return"object"==typeof t&&t instanceof Array},r=function(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)},o=function(t,e){var n,r,o,i,a=e.length,f=t.length;for(i=function(r){o=c(t[r],e[r]),o!==void 0&&(n===void 0&&(n={_t:"a"}),n[r]=o)},r=0;Math.max(a,f)>r;r++)i(r);return n},i=function(t,e,n){var r,o,i=t.length,a=e.length,f=0;o="function"==typeof n?n:function(t){return t[n]};for(var u=0;a>u;u++)r===void 0&&(r={_t:"a"}),r[o(e[u])]=[e[u]],f++;for(var u=0;i>u;u++){var p=o(t[u]);if(r===void 0||r[p]===void 0)r===void 0&&(r={_t:"a"}),r[p]=[t[u],0,0],f++;else{var l=c(t[u],r[p][0]);l===void 0?(delete r[p],f--):r[p]=l}}return f>0?r:void 0},a=function(t,e){var r,o,i,a;a=function(){n(e[i])&&(e[i+"_key"]||e["_"+i+"_key"])&&(e[i]._key=e[i+"_key"]||e["_"+i+"_key"]),n(t[i])&&(t[i+"_key"]||t["_"+i+"_key"])&&(t[i]._key=t[i+"_key"]||t["_"+i+"_key"]),o=c(t[i],e[i]),o!==void 0&&(r===void 0&&(r={}),r[i]=o)};for(i in e)e.hasOwnProperty(i)&&a(i);for(i in t)t.hasOwnProperty(i)&&e[i]===void 0&&a(i);return r},c=t.diff=function(c,f){var u,p,l,h,s;if(c!==f&&(u=typeof f,p=typeof c,l=null===f,h=null===c,"object"==p&&r(c)&&(p="date"),"object"!=u||!r(f)||(u="date","date"!=p||c.getTime()!==f.getTime()))){if(l||h||"undefined"==u||u!=p||"number"==u||"number"==p||"boolean"==u||"boolean"==p||"string"==u||"string"==p||"date"==u||"date"==p||"object"===u&&n(f)!=n(c)){if(s=[],c!==void 0)if(f!==void 0){var d="string"==u&&"string"==p&&Math.min(c.length,f.length)>t.config.textDiffMinLength;d&&!t.config.textDiff&&e(),d&&t.config.textDiff?s.push(t.config.textDiff(c,f),0,2):(s.push(c),s.push(f))}else s.push(c),s.push(0,0);else s.push(f);return s}return n(f)?f._key||c._key?i(c,f,f._key||c._key):o(c,f):a(c,f)}},f=function(t,e){if(!n(t)||!t._key)return t[e];var r=t._key;"function"!=typeof t._key&&(r=function(e){return e[t._key]});for(var o=0;t.length>o;o++)if(r(t[o])===e)return t[o]};t.getByKey=f;var u=function(t,e,r){if(n(t)&&t._key){var o=t._key;"function"!=typeof t._key&&(o=function(e){return e[t._key]});for(var i=0;t.length>i;i++)if(o(t[i])===e)return r===void 0?(t.splice(i,1),i--):t[i]=r,void 0;return r!==void 0&&t.push(r),void 0}r===void 0?n(t)?t.splice(e,1):delete t[e]:t[e]=r},p=function(e){return t.config.textDiffReverse||(t.config.textDiffReverse=function(t){var e,n,r,o,i,a,c,f=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=t.split("\n"),e=0,n=r.length;n>e;e++){o=r[e];var p=o.slice(0,1);"@"===p?(f=u.exec(o),i=e,a=null,c=null,r[i]="@@ -"+f[3]+","+f[4]+" +"+f[1]+","+f[2]+" @@"):"+"==p?(a=e,r[e]="-"+r[e].slice(1)):"-"==p&&(c=e,r[e]="+"+r[e].slice(1))}return r.join("\n")}),t.config.textDiffReverse(e)},l=t.reverse=function(t){var e,o;if(void 0!==t){if(null===t)return null;if("object"==typeof t&&!r(t)){if(n(t)){if(3>t.length)return 1==t.length?[t[0],0,0]:[t[1],t[0]];if(0==t[2])return[t[0]];if(2==t[2])return[p(t[0]),0,2];throw Error("invalid diff type")}o={};for(e in t)t.hasOwnProperty(e)&&(o[e]=l(t[e]));return o}return"string"==typeof t&&"@@"===t.slice(0,2)?p(t):t}},h=t.patch=function(r,o,i,a){var c,p,l,s="";if("string"!=typeof o?(a=i,i=o,o=null):"object"!=typeof r&&(o=null),a&&(s+=a),s+="/",null!==o&&(s+=o),"object"==typeof i)if(n(i)){if(3>i.length)return p=i[i.length-1],null!==o&&u(r,o,p),p;if(0!=i[2]){if(2==i[2]){if(t.config.textPatch||e(),!t.config.textPatch)throw Error("textPatch function not found");try{p=t.config.textPatch(f(r,o),i[0])}catch(d){throw Error('cannot apply patch at "'+s+'": '+d)}return null!==o&&u(r,o,p),p}throw Error("invalid diff type")}if(null===o)return;u(r,o)}else if("a"==i._t){if(l=null===o?r:f(r,o),"object"!=typeof l||!n(l))throw Error('cannot apply patch at "'+s+'": array expected');for(c in i)"_t"!==c&&i.hasOwnProperty(c)&&h(l,c,i[c],s)}else{if(l=null===o?r:f(r,o),"object"!=typeof l||n(l))throw Error('cannot apply patch at "'+s+'": object expected');for(c in i)i.hasOwnProperty(c)&&h(l,c,i[c],s)}return r};t.unpatch=function(t,e,n,r){return"string"!=typeof e?h(t,l(e),n):h(t,e,l(n),r)},"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=t:"function"==typeof define&&define.amd?define(t):window.jsondiffpatch=t}();var jsonpatch;(function(t){function e(t,e,r){n(t,e,r,null)}function n(t,e,r){Object.observe(t,function(n){n.forEach(function(t){a[t.type].call(t,n,"?")}),r&&r.call(t,e)});for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];i&&"object"==typeof i&&n(i,e,r,t)}}function r(t,e){try{e.forEach(function(e){var n=e.path.split("/");n.shift();for(var r=t,a=0,c=n.length;;)if(r instanceof Array){var f=parseInt(n[a],10);if(a++,a>=c){i[e.op].call(e,r,f,t);break}r=r[f]}else{var u=n[a];if(-1!=u.indexOf("~")&&(u=u.replace("~1","/").replace("~0","~")),a++,a>=c){o[e.op].call(e,r,u,t);break}r=r[u]}})}catch(n){return!1}return!0}var o={add:function(t,e){t[e]=this.value},remove:function(t,e){delete t[e]},replace:function(t,e){t[e]=this.value},move:function(t,e,n){var o={op:"_get",path:this.from};r(n,[o],void 0),r(n,[{op:"remove",path:this.from}],void 0),r(n,[{op:"add",path:this.path,value:o.value}])},copy:function(t,e,n){var o={op:"_get",path:this.from};r(n,[o],void 0),r(n,[{op:"add",path:this.path,value:o.value}])},test:function(t,e){if(JSON.stringify(t[e])!=JSON.stringify(this.value))throw""},_get:function(t,e){this.value=t[e]}},i={add:function(t,e){t.splice(e,0,this.value)},remove:function(t,e){t.splice(e,1)},replace:function(t,e){t[e]=this.value},move:o.move,copy:o.copy,test:o.test,_get:o._get},a={"new":function(t,e){var n={op:"iadd",path:e+this.name,value:this.object[this.name]};t.push(n)},deleted:function(t,e){var n={op:"iremove",path:e+this.name};t.push(n)},updated:function(t,e){var n={op:"ireplace",path:e+this.name,value:this.object[this.name]};t.push(n)}};t.listenTo=e,t.apply=r})(jsonpatch||(jsonpatch={}));